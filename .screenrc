#
# GNU Screen 5.0 Configuration
# BREAKING CHANGES from Screen 4.x:
# - Color syntax changed: OLD %{= kR} â†’ NEW %{7;1} (numeric fg;bg format)
# - Escape codes changed: %s now = screen size (was seconds), %S = session name
# - No native seconds escape; use backtick with 'date' command instead

# Set the correct terminfo for screen itself
term screen.xterm-256color

# Color support configuration
    defbce on
    termcapinfo xterm* ti@:te@

    # Force Screen to use proper background colors
    termcapinfo xterm* 'AB=\E[48;5;%p1%dm:AF=\E[38;5;%p1%dm:Sb=\E[4%p1%dm:Sf=\E[3%p1%dm'

    # Enable truecolor support (24-bit color)
    truecolor on

    # Force Screen to use background erase
    termcapinfo xterm* 'ut'

# Alt-.
    bindkey "^[." next # . for next window
# Alt-,
    bindkey "^[," prev # , for previous window

# FINALLY! - After close to 5 years of pain, we can have some meaningful navigation
    bindkey "^[k" focus up    #
    bindkey "^[j" focus down  #
    bindkey "^[h" focus left  #
    bindkey "^[l" focus right #

# Splits
   bindkey "^[s" split
   bindkey "^[v" split -v

# Remove
   bindkey "^[x" remove

# Create a new screen
    bindkey "^[n" screen

# Maximize/Fit the region
    bindkey "^[M" fit

# Colon/Command mode
    bindkey "^[:" colon
    bindkey "^[;" colon

# Resize regions
    bindkey "^[[1;3D" resize -1 #  Left Arrow Key = reduce size
    bindkey "^[[1;3C" resize +1 # Right Arrow Key = increase size

    bindkey "^[[1;3A" resize +1 #    Up Arrow Key = increase size
    bindkey "^[[1;3B" resize -1 #  Down Arrow Key = reduce size

    bindkey "^[F" focusminsize max max # This is magic
    #bindkey "^[f" focusminsize 0 0     # This undo's the magic. Right after this, do `resize N`
    bindkey "^[-" focusminsize 0 0
    bindkey "^[=" resize =

    bindkey "^[+" resize N

# Only
    bindkey "^q" only


# Layout
    bindkey "^[N" layout new  # Creates a new layout. This gives you an empty layout
    bindkey "^[<" layout prev # goes to the next layout
    bindkey "^[>" layout next # goes to the prev layout

# Copy mode
    bindkey "^[p" copy
    bindkey "^[P" paste

# Number of scrollback lines
    defscrollback 40960

# WORK IN PROGRESS
    startup_message off
    shelltitle ''
    shell -${SHELL}

    #backtick 0 30 30 sh -c 'iwgetid -r'

# Status bar (bottom bar, one per screen session)
    # Screen 5.0 color syntax: %{fg;bg} where colors are numeric (0-7 for basic ANSI)
    # Colors: 0=black 1=red 2=green 3=yellow 4=blue 5=magenta 6=cyan 7=white
    # Original: "%{= Bk} %H %{= kw} %-Lw%{KG}%25> %n:%t %{= kw}%+w %-= %{= KW} %l %{= kG} %{= Bk} %D, %d %M %{= kw} %{= Bk}%C:%s%A "
    # Fix: %l doesn't work in Screen 5.0, using backtick for load average
    backtick 1 1 1 date '+%I:%M:%S %p'
    backtick 2 5 5 cut -d" " -f1-3 /proc/loadavg
    attrcolor b ".I"
    hardstatus alwayslastline "%{0;4} %H %{7;0} %-Lw%{0;2}%25> %n:%t %{7;0}%+w %-= %{0;245} %2` %{7;0} %{0;4} %D, %d %M %{7;0} %{0;4} %1` "

# Caption bar (per-window bar for splits)
    # Original: "%{= wk}%?%F%{= Mk}%? -%n- %t %= %t -%n- "
    # Using 256-color gray (245) instead of white (7) for inactive windows
    # Active: black on magenta (0;5), Inactive: black on gray (0;245)
    caption always "%?%F%{0;5}%:%{0;245}%? -%n- %t %= %t -%n- "


# Vertical bar
    # Limited to basic 8 colors (can't use gray 245), keeping white as closest option
    sorendition wr

# Messages
    activity "Someone's tinkering in %t(%n)"

# hardcopy - C-a h
    hardcopydir ~/.screen-hardcopy

# bufferFile
    bufferfile /tmp/.screen_exchange

# Paste stuff to clipboard from scrollback buffer
#    bind b eval "writebuf" "exec sh -c '/home/jjose/bin/xsel -c -i'"

# Multiuser
    multiuser on

# Power Detach Message
    pow_detach_msg "Screen session of \$LOGNAME \$:cr: \$:nl:ended."

# bind shift-<numbers> for window selections
    bind )  select  10
    bind !  select  11
    bind @  select  12
    bind \# select  13
    bind \$ select  14
    bind %  select  15
    bind \^ select  16
    bind &  select  17
    bind *  select  18
    bind (  select  19

    bindkey "^[1" layout select 'default'
    bindkey "^[2" layout select 'tp2'

# Open a new layout
    layout new "default"
