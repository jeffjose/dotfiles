#
# tmux configuration - mirrors screen keybindings
#

# ============================================
# General Settings
# ============================================

# Use 256 colors and truecolor
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Scrollback buffer
set -g history-limit 40960

# No startup message (like screen's startup_message off)
set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity off
set -g bell-action none

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Faster key repetition
set -s escape-time 0

# Enable mouse (optional, screen doesn't have this)
set -g mouse on

# ============================================
# Navigation - Alt+hjkl (no prefix needed)
# ============================================

# Alt+h/j/k/l = focus left/down/up/right
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Alt+./,  = next/prev window
bind -n M-. next-window
bind -n M-, previous-window

# ============================================
# Splits - Alt+s/v (no prefix needed)
# ============================================

# Alt+s = split horizontal (top/bottom)
bind -n M-s split-window -v -c "#{pane_current_path}"

# Alt+v = split vertical (left/right)
bind -n M-v split-window -h -c "#{pane_current_path}"

# Alt+x = close pane
bind -n M-x kill-pane

# Alt+n = new pane (split, like screen's "screen" in a region)
# Uses last split direction, defaults to horizontal
bind -n M-n split-window -c "#{pane_current_path}"

# Alt+N = new window (new tab)
bind -n M-N new-window -c "#{pane_current_path}"

# ============================================
# Resize - Alt+Arrow keys
# ============================================

# Alt+Arrow = resize pane
bind -n M-Left  resize-pane -L 1
bind -n M-Right resize-pane -R 1
bind -n M-Up    resize-pane -U 1
bind -n M-Down  resize-pane -D 1

# Alt+= = equal size panes
bind -n M-= select-layout tiled

# Alt+F = zoom/maximize pane (toggle)
bind -n M-F resize-pane -Z

# ============================================
# Layouts
# ============================================

# Alt+Shift+N = new session (like screen's layout new)
bind -n M-N new-session

# Alt+< / Alt+> = switch sessions (like screen's layout prev/next)
bind -n M-< switch-client -p
bind -n M-> switch-client -n

# Ctrl+q = close all other panes (like screen's "only")
bind -n C-q kill-pane -a

# ============================================
# Copy Mode - Alt+p (like screen)
# ============================================

# Alt+p = enter copy mode (like screen's copy)
bind -n M-p copy-mode

# Alt+P = paste (like screen's paste)
bind -n M-P paste-buffer

# Use vi keys in copy mode
setw -g mode-keys vi

# v to start selection, y to yank
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# ============================================
# Command Mode
# ============================================

# Alt+: or Alt+; = command prompt
bind -n M-: command-prompt
bind -n M-\; command-prompt

# ============================================
# Window Selection (like screen's shift+number)
# ============================================

bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9
bind -n M-0 select-window -t 10

# ============================================
# Status Bar (matches screen exactly)
# ============================================
# Screen colors: 0=black 1=red 2=green 3=yellow 4=blue 5=magenta 6=cyan 7=white

set -g status on
set -g status-interval 1
set -g status-position bottom

# Main status bar: white on black (like screen's %{7;0})
set -g status-style "bg=colour0,fg=colour7"

# Left: hostname in black on blue (like screen's %{0;4} %H)
set -g status-left "#[bg=colour4,fg=colour0] #H #[bg=colour0,fg=colour7] "
set -g status-left-length 30

# Right: load avg (black on gray), date/time (black on blue)
# Matches: %{0;245} %2` %{7;0} %{0;4} %D, %d %M %{7;0} %{0;4} %1`
set -g status-right "#[bg=colour245,fg=colour0] #(cut -d' ' -f1-3 /proc/loadavg) #[bg=colour0,fg=colour7] #[bg=colour4,fg=colour0] %a, %d %b #[bg=colour0,fg=colour7] #[bg=colour4,fg=colour0] %I:%M:%S %p "
set -g status-right-length 60

# Window list: white on black, current window black on green
# Matches: %{7;0} %-Lw %{0;2} %n:%t %{7;0} %+w
set -g window-status-format "#[bg=colour0,fg=colour7] #I:#W "
set -g window-status-current-format "#[bg=colour2,fg=colour0] #I:#W "
set -g window-status-separator ""

# ============================================
# Pane borders (matches screen's caption)
# ============================================
# Active: black on magenta (%{0;5})
# Inactive: black on gray (%{0;245})

set -g pane-border-style "fg=colour245"
set -g pane-active-border-style "fg=colour5"

# Pane status (like screen's caption per-pane)
set -g pane-border-status bottom
set -g pane-border-format "#[bg=colour245,fg=colour0] -#P- #T "
set -gw pane-border-format "#{?pane_active,#[bg=colour5],#[bg=colour245]}#[fg=colour0] -#P- #T "

# Pane display (show pane numbers)
set -g display-panes-time 2000
set -g display-panes-colour colour245
set -g display-panes-active-colour colour5

# ============================================
# Message styling
# ============================================

set -g message-style "bg=colour5,fg=colour0"
